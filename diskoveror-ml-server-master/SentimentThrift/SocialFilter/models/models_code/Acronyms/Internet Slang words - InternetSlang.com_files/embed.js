(function(){var window=this;var comments_wioget_ids=[];if(window.solidopinion_global_object&&typeof window.solidopinion_global_object==="object"){return;}var SO_VERSION="1.2.21.3",so;if(!window.soNewId){window.soNewId=(function(){var id=0;return function(){return"so_"+id++;};})();}if(!window.soNewId){window.soNewId=(function(){var id=0;return function(){return"so_"+id++;};})();}var ssid=(function(){var s=[],itoh="0123456789ABCDEF";for(var i=0;i<36;i++){s[i]=Math.floor(Math.random()*16);}s[14]=4;s[19]=(s[19]&3)|8;for(var i=0;i<36;i++){s[i]=itoh[s[i]];}s[8]=s[13]=s[18]=s[23]="-";return s.join("");})();var glang=false;var is_su=function(){if(navigator.userAgent.indexOf("IEMobile")!==-1){return false;}if(typeof window.hasOwnProperty=="undefined"){return false;}try{return typeof JSON==="object"&&typeof JSON.parse==="function"&&"localStorage" in window&&window["localStorage"]!==null;}catch(e){}return false;}();var getElementsByClassName=function(className,tag,elm){if(document.getElementsByClassName){getElementsByClassName=function(className,tag,elm){elm=elm||document;var elements=elm.getElementsByClassName(className),nodeName=(tag)?new RegExp("\\b"+tag+"\\b","i"):null,returnElements=[],current;for(var i=0,il=elements.length;i<il;i+=1){current=elements[i];if(!nodeName||nodeName.test(current.nodeName)){returnElements.push(current);}}return returnElements;};}else{if(document.evaluate){getElementsByClassName=function(className,tag,elm){tag=tag||"*";elm=elm||document;var classes=className.split(" "),classesToCheck="",xhtmlNamespace="http://www.w3.org/1999/xhtml",namespaceResolver=(document.documentElement.namespaceURI===xhtmlNamespace)?xhtmlNamespace:null,returnElements=[],elements,node;for(var j=0,jl=classes.length;j<jl;j+=1){classesToCheck+="[contains(concat(' ', @class, ' '), ' "+classes[j]+" ')]";}try{elements=document.evaluate(".//"+tag+classesToCheck,elm,namespaceResolver,0,null);}catch(e){elements=document.evaluate(".//"+tag+classesToCheck,elm,null,0,null);}while((node=elements.iterateNext())){returnElements.push(node);}return returnElements;};}else{getElementsByClassName=function(className,tag,elm){tag=tag||"*";elm=elm||document;var classes=className.split(" "),classesToCheck=[],elements=(tag==="*"&&elm.all)?elm.all:elm.getElementsByTagName(tag),current,returnElements=[],match;for(var k=0,kl=classes.length;k<kl;k+=1){classesToCheck.push(new RegExp("(^|\\s)"+classes[k]+"(\\s|$)"));}for(var l=0,ll=elements.length;l<ll;l+=1){current=elements[l];match=false;for(var m=0,ml=classesToCheck.length;m<ml;m+=1){match=classesToCheck[m].test(current.className);if(!match){break;}}if(match){returnElements.push(current);}}return returnElements;};}}return getElementsByClassName(className,tag,elm);};window.log=function(){try{return console.log.apply(console,arguments);}catch(_error){}};var current_browser=(function(){var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE "+(tem[1]||"");}if(M[1]==="Chrome"){tem=ua.match(/\bOPR\/(\d+)/);if(tem!=null){return"Opera "+tem[1];}}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null){M.splice(1,1,tem[1]);}return M.join(" ");})();var clone=function(o){if(!o||"object"!==typeof o){return o;}var c="function"===typeof o.pop?[]:{};var p,v;for(p in o){if(o.hasOwnProperty(p)){v=o[p];if(v&&"object"===typeof v){c[p]=clone(v);}else{c[p]=v;}}}return c;};var jsonStringify=function(obj){if(typeof JSON==="object"){return JSON.stringify(obj);}else{var t=typeof(obj);if(t!="object"||obj===null){if(t=="string"){obj='"'+obj+'"';}return String(obj);}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){if(!obj.hasOwnProperty(n)){continue;}v=obj[n];t=typeof(v);if(t=="string"){v='"'+v+'"';}else{if(t=="object"&&v!==null){v=jsonStringify(v);}}json.push((arr?"":'"'+n+'":')+String(v));}return(arr?"[":"{")+String(json)+(arr?"]":"}");}}};var jsonParse=function(str){if(typeof JSON==="object"){return JSON.parse(str);}else{if(str===""){str='""';}eval("var p="+str+";");return p;}};var getOfsetTop=function(node,without_scrol){var curtop=0,curtopscroll=0;if(without_scrol!==true){without_scrol=false;}if(node.offsetParent){do{curtop+=node.offsetTop;if(!without_scrol){curtopscroll+=node.offsetParent?node.offsetParent.scrollTop:0;}}while(node=node.offsetParent);if(without_scrol){return(Math.abs(curtop));}return(Math.abs(curtop-curtopscroll));}};var getByClassName=function(classname){var elArray=[];if(getElementsByClassName){var tmp=document.getElementsByTagName("*");var regex=new RegExp("(^|\\s)"+classname+"(\\s|$)");for(var i in tmp){if(typeof tmp.hasOwnProperty=="undefined"||tmp.hasOwnProperty(i)){if(regex.test(tmp[i].className)){elArray.push(tmp[i]);}}}}else{elArray=getElementsByClassName(classname);}return elArray;};var resizeFrameById=function(data){if(!data.frame_id){return;}var el=document.getElementById(data.frame_id);if(data.height){el.style.height=data.height+"px";}if(data.width){el.style.width=data.width+"px";}if(data.minWidth){el.style.minWidth=data.minWidth+"px";}el=null;};var sendToFrame=function(data,comand){if(data.frame_id){var el=document.getElementById(data.frame_id);el.contentWindow.postMessage(comand+";"+jsonStringify(data)+";","*");}else{var frames=document.getElementsByTagName("iframe");if(!data){data={};}for(var i=0;i<frames.length;i++){var frame=frames[i];if(/so_/.test(frame.getAttribute("id"))){frame.contentWindow.postMessage(comand+";"+jsonStringify(data)+";","*");}}}};var windowScroll=function(){var y=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,e;if((window.innerHeight+y)>=document.body.offsetHeight){sendToFrame({},"scrollBottom");}for(var i in comments_wioget_ids){e=comments_wioget_ids[i];if(window.innerHeight+y+getOffsetTop(e)>=document.body.offsetHeight){sendToFrame(e.id,"scrollBottom");}}};var getOffsetTop=function(elem){var offsetTop=0;do{if(!isNaN(elem.offsetTop)){offsetTop+=elem.offsetTop;}}while(elem=elem.offsetParent);return offsetTop;};var listener=function(e){var command=String(e.data).split(";");var eventName=command[0];var data="";try{data=command[1]?jsonParse(command[1]):"";}catch(e){}var el=false;if(data.frame_id){el=document.getElementById(data.frame_id);}switch(eventName){case"ready":so.onFrameReady();break;case"returnMessageCount":try{so.setCounts(data);}catch(e){}break;case"resizeFrameById":try{resizeFrameById(data);}catch(e){}break;case"removeFrameById":try{so.removeFrameById(data);}catch(e){}break;case"scrollTo":if(el&&data.position){window.scrollTo(0,parseInt(getOfsetTop(el,true))+parseInt(data.position));}break;case"setHash":window.location.hash=data.hash;break;case"setHref":window.location.href=data.href;break;case"placeWidget":if(el){var add=0;if(data&&data.position){add=parseInt(data.position);}if(getOfsetTop(el)>50){window.scrollTo(0,parseInt(getOfsetTop(el,true)+add));}}break;case"getHash":if(el){sendToFrame({frame_id:data.frame_id,hash:window.location.hash},"setHash");}break;case"sfGetScroll":if(el){var doc=document.documentElement,body=document.body;var topscrollpos=(doc&&doc.scrollTop||body&&body.scrollTop||0);sendToFrame({frame_id:data.frame_id,topscrollpos:topscrollpos},"setDest");}break;case"getOffsetTop":if(el){sendToFrame({frame_id:data.frame_id,topOffset:getOfsetTop(el,true)},"setTopOffset");}break;}};if(window.addEventListener){addEventListener("scroll",windowScroll,false);addEventListener("message",listener,false);}else{attachEvent("scroll",windowScroll);attachEvent("onmessage",listener);}function sObject(){this.allready=false;this.data_frame_ready=false;this.data_frame=false;this.counter_items=[];this.counter_config={};this.messages_pull=[];}sObject.prototype={constructor:sObject,init:function(fn){if(typeof fn==="function"){this.fn=fn;}if(document.readyState==="complete"){setTimeout(this.ready,1);}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",so.DOMContentLoaded,false);window.addEventListener("load",so.onready,false);}else{document.attachEvent("onreadystatechange",so.DOMContentLoaded);window.attachEvent("onload",so.onready);}}},onready:function(){if(so.allready){return;}if(!document.body){return setTimeout(so.onready,100);}so.allready=true;so.ready();},ready:function(){if(so.fn){so.fn();}},initRating:function(){var rating_items=getByClassName("so_rating");var element,rating_config={};for(var i=0,e=rating_items.length;i<e;i++){element=rating_items[i];if(element.innerHTML&&element.innerHTML.indexOf("iframe")>=0){continue;}if(typeof sc_config!="undefined"){rating_config=clone(sc_config);}var conf=this.getConfigs(element,rating_config);for(var x in conf){if(conf.hasOwnProperty(x)){rating_config[x]=conf[x];}}rating_config.type="rating";element.innerHTML="<iframe id='"+rating_config.frame_id+"' style='width: 200px;border: none;height: 24px;' src='"+this.getFrameUrl(rating_config)+"'></iframe>";}},initComments:function(old){var comments_items=getByClassName("so_comments");var old_el=document.getElementById("solidopinion_thread");if(old_el){comments_items.push(document.getElementById("solidopinion_thread"));}var element,so_config_temlate=window.so_config?window.so_config:{};for(var i=0,e=comments_items.length;i<e;i++){var so_config=clone(so_config_temlate);element=comments_items[i];if(element.innerHTML&&element.innerHTML.indexOf("iframe")>=0){continue;}so_config.type="widget";var conf=this.getConfigs(element,window.so_config);for(var x in conf){if(conf.hasOwnProperty(x)){if(x=="type"){so_config["widget_type"]=conf[x];continue;}so_config[x]=conf[x];}}if(old){var f_src=so_config.siteuri.replace("/embed.html","/simple/")+"?sitename="+so_config.sitename+"&thread_url="+so_config.thead+"&order=&s=1";element.innerHTML='<iframe style="min-width: 200px" width="100%" height="400px" scrolling="yes" frameborder="0" id="sfIframe" data-uid="1" allowtransparency="true" role="application" style="width: 100%; border: medium none; overflow: hidden;" src="'+f_src+'" horizontalscrolling="no" verticalscrolling="no"></iframe>';}else{element.innerHTML='<iframe id="'+so_config.frame_id+'" style="min-width: 200px" width="100%" height="40px" scrolling="no" frameborder="0" id="sfIframe" data-uid="1" allowtransparency="true" role="application" style="width: 100%; border: medium none; overflow: hidden;" src="'+this.getFrameUrl(so_config)+'" horizontalscrolling="no" verticalscrolling="no"></iframe>';}if(so_config&&so_config.frame_id){var el=document.getElementById(so_config.frame_id);if(el&&el.id){comments_wioget_ids.push(el);}}}},initCommunity:function(){var community_items=getByClassName("so_community");var old_el=document.getElementById("solidopinion_community");if(old_el){community_items.push(document.getElementById("solidopinion_community"));}var element,so_config_temlate=window.soc_config?window.soc_config:{};for(var i in community_items){var so_config=clone(so_config_temlate);element=community_items[i];if(element.innerHTML&&element.innerHTML.indexOf("iframe")>=0){continue;}so_config.type="community";var conf=this.getConfigs(element,so_config);for(var x in conf){if(conf.hasOwnProperty(x)){so_config[x]=conf[x];}}element.innerHTML='<iframe id="'+so_config.frame_id+'" style="min-width: 200px" width="100%" height="40px" scrolling="no" frameborder="0" id="sfIframe" data-uid="1" allowtransparency="true" role="application" style="width: 100%; border: medium none; overflow: hidden;" src="'+this.getFrameUrl(so_config)+'" horizontalscrolling="no" verticalscrolling="no" allowtransparency="true"></iframe>';}},getConfigs:function(el,conf){var so_config={},attr_arr={},tmpaname="";so_config.ssid=ssid;so_config.frame_id=soNewId();so_config.thead=window.location.pathname+window.location.search;so_config.parent=window.location.hostname;so_config.parent_href=window.location.href;so_config.hash=window.location.hash;so_config.social_title=conf&&conf.thread_title?conf.thread_title:"From SolidOpinion";so_config.thread_title=conf&&conf.thread_title?conf.thread_title:document.title;if(typeof el=="object"){for(var i=0,attrs=el.attributes,l=attrs.length;i<l;i++){if(/data-.+/i.test(attrs.item(i).nodeName)){attr_arr[attrs.item(i).nodeName.replace(/(data-)/i,"")]=attrs.item(i).nodeValue;}}var v=el.getAttribute("data-version");if(!v&&conf){v=conf.version;}so_config.version=v||v=="-"?v:SO_VERSION;for(var i in attr_arr){if(attr_arr.hasOwnProperty(i)){if(i=="version"){continue;}else{if(i=="colors"){try{so_config.colors=jsonParse(attr_arr[i]);}catch(e){}}else{if(i=="thread_url"){so_config[i]=encodeURI(attr_arr[i]);}else{so_config[i]=attr_arr[i];}}}}}}var surl="//api.solidopinion.com/frontend/embed.html";if(so_config.server=="release"){surl="//api-release.solidopinion.com/frontend/embed.html";}else{if(so_config.server=="dev"){surl="//api-dev.solidopinion.com/frontend/embed.html";}}if(!so_config.siteuri){so_config.siteuri=conf&&conf.siteuri?conf.siteuri:surl;}return so_config;},initCounter:function(){this.counter_items=getByClassName("so_counter");var i,urls=[];for(i in this.counter_items){if(this.counter_items.hasOwnProperty(i)){var ci=this.counter_items[i];urls.push({"urls":encodeURI(ci.getAttribute("data-thread_url")),"name":ci.getAttribute("data-sitename")});if(this.counter_items[i].getAttribute("data-sitename")){var g=Number(ci.getAttribute("data-language_id"));if(g>=0&&g<4){glang=g;}}if(!this.counter_config.server&&ci.getAttribute("data-server")){this.counter_config.server=ci.getAttribute("data-server");}if(!this.counter_config.siteuri&&ci.getAttribute("data-siteuri")){this.counter_config.siteuri=ci.getAttribute("data-siteuri");}if(!this.counter_config.api_url&&ci.getAttribute("data-api_url")){this.counter_config.api_url=ci.getAttribute("data-api_url");}if(!this.counter_config.cdn_url&&ci.getAttribute("data-cdn_url")){this.counter_config.cdn_url=ci.getAttribute("data-cdn_url");}if(!this.counter_config.libs_url&&ci.getAttribute("data-libs_url")){this.counter_config.libs_url=ci.getAttribute("data-libs_url");}if(!this.counter_config.version&&ci.getAttribute("data-version")){this.counter_config.version=ci.getAttribute("data-version");}if(!this.counter_config.dev&&ci.getAttribute("data-dev")){this.counter_config.dev=ci.getAttribute("data-dev");}}}if(urls.length>0){this.postMessage(jsonStringify(urls),"getMessageCount");}},initBridge:function(){if(this.data_frame){return;}var conf={};if(typeof sc_config!="undefined"){conf=clone(sc_config);}else{conf=clone(this.counter_config);}if(glang){conf.language_id=glang;}conf.ssid=ssid;conf.protocol=("https:"==document.location.protocol?"https":"http");conf.type="counter";if(!conf.version){conf.version=SO_VERSION;}var surl="//api.solidopinion.com/frontend/embed.html";if(conf.server=="release"){surl="//api-release.solidopinion.com/frontend/embed.html";}else{if(conf.server=="dev"){surl="//api-dev.solidopinion.com/frontend/embed.html";}}conf.siteuri=conf&&conf.siteuri?conf.siteuri:surl;var data_frame=document.getElementById("solidopinion_data_frame");data_frame=document.createElement("iframe");data_frame.id="solidopinion_data_frame";data_frame.style.display="none";data_frame.src=conf.siteuri+"?so_config="+encodeURIComponent(jsonStringify(conf));document.body.appendChild(data_frame);this.data_frame=data_frame;},onFrameReady:function(){this.data_frame_ready=true;for(var i in this.messages_pull){if(this.messages_pull.hasOwnProperty(i)){var m=this.messages_pull[i];this.postMessage(m.message,m.comand);}}},postMessage:function(message,comand){if(!this.data_frame_ready){this.messages_pull.push({"message":message,"comand":comand});this.initBridge();}else{this.data_frame.contentWindow.postMessage(comand+";"+message,"*");}},getFrameUrl:function(config){if(!config.siteuri){config.siteuri=sc_config.siteuri;}return config.siteuri+"?so_config="+encodeURIComponent(jsonStringify(config));},removeFrameById:function(data){if(!data.frame_id){return;}var el=document.getElementById(data.frame_id);el.parentNode.removeChild(el);},setCounts:function(data){this.counter_items=getByClassName("so_counter");var i,url,element,count;for(i in this.counter_items){if(this.counter_items.hasOwnProperty(i)){element=this.counter_items[i];url=encodeURI(element.getAttribute("data-thread_url"));var findCount=function(u,counts){var x,z;for(z in counts.data){if(counts.data.hasOwnProperty(z)){x=counts.data[z];if(x[0]==u){return x[1];}}}return"";};count=findCount(url,data);if(count){element.innerHTML=count;}}}},DOMContentLoaded:function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",so.DOMContentLoaded,false);so.onready();}else{if(document.readyState==="complete"){document.detachEvent("onreadystatechange",so.DOMContentLoaded);so.onready();}}}};if(typeof window.solidopinion_global_object=="undefined"){window.solidopinion_global_object=new sObject();}so=window.solidopinion_global_object;if(is_su){so.initComments();so.initCommunity();so.init(function(){so.initRating();so.initCounter();so.initComments();so.initCommunity();});}else{so.initComments(true);}})();
